<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= pageTitle %> | Ø±Ø§ÙŠØ© Ø§Ù„ÙØ±Ø³Ø§Ù†</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <style>
    .admin-container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
    .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .admin-header h1 { color: #e94560; margin: 0; }
    .admin-nav { display: flex; gap: 12px; }
    .admin-nav a {
      padding: 8px 16px;
      background: #16213e;
      color: #e0e0e0;
      text-decoration: none;
      border-radius: 8px;
      font-family: inherit;
    }
    .admin-nav a:hover { background: #e94560; color: white; }
    .admin-nav a.active { background: #e94560; color: white; }
    .tables-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }
    .table-card {
      background: #16213e;
      border-radius: 12px;
      padding: 24px;
      transition: transform 0.2s;
    }
    .table-card:hover { transform: translateY(-2px); }
    .table-card a { text-decoration: none; color: inherit; display: block; }
    .table-card h3 { color: #e94560; margin: 0 0 8px 0; font-size: 20px; }
    .table-card .count { color: #aaa; font-size: 14px; }
    .table-card .count span { color: #64b5f6; font-size: 24px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="admin-container">
    <div class="admin-header">
      <h1>ğŸ› ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
      <div class="admin-nav">
        <a href="/admin" class="active">Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</a>
        <a href="/admin/query">Ø§Ø³ØªØ¹Ù„Ø§Ù… SQL</a>
        <a href="/">Ø§Ù„Ù…ÙˆÙ‚Ø¹</a>
        <a href="/admin/logout">Ø®Ø±ÙˆØ¬</a>
      </div>
    </div>

    <div style="display:flex; gap:12px; margin-bottom:24px; flex-wrap:wrap;">
      <a href="/admin/export" style="padding:12px 24px; background:#2196F3; color:white; border:none; border-radius:8px; font-family:inherit; font-size:16px; cursor:pointer; text-decoration:none; display:inline-block;">ğŸ“¥ ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
      <label style="padding:12px 24px; background:#FF9800; color:white; border:none; border-radius:8px; font-family:inherit; font-size:16px; cursor:pointer; display:inline-block;">
        ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        <input type="file" accept=".json" onchange="importDB(this)" style="display:none;">
      </label>
      <button onclick="seedDB()" id="seed-btn" style="padding:12px 24px; background:#4CAF50; color:white; border:none; border-radius:8px; font-family:inherit; font-size:16px; cursor:pointer;">ğŸŒ± Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
      <button onclick="clearDB()" id="clear-btn" style="padding:12px 24px; background:#f44336; color:white; border:none; border-radius:8px; font-family:inherit; font-size:16px; cursor:pointer;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
    </div>
    <div id="seed-status" style="margin-bottom:16px; padding:12px; border-radius:8px; display:none;"></div>

    <script>
      async function importDB(input) {
        const file = input.files[0];
        if (!file) return;
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ©/Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©.')) {
          input.value = '';
          return;
        }
        const status = document.getElementById('seed-status');
        status.style.display = 'block';
        status.style.background = '#2196F3';
        status.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡...';
        try {
          const text = await file.text();
          const data = JSON.parse(text);
          const res = await fetch('/admin/import', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          const result = await res.json();
          if (result.success) {
            status.style.background = '#4CAF50';
            status.textContent = result.message;
            setTimeout(() => location.reload(), 2000);
          } else {
            status.style.background = '#f44336';
            status.textContent = result.error;
          }
        } catch (e) {
          status.style.background = '#f44336';
          status.textContent = 'Ø®Ø·Ø£: ' + e.message;
        }
        input.value = '';
      }

      async function seedDB() {
        if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ù„Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©ØŸ')) return;
        const btn = document.getElementById('seed-btn');
        const status = document.getElementById('seed-status');
        btn.disabled = true;
        btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ù„Ø¡...';
        try {
          const res = await fetch('/admin/seed', { method: 'POST', headers: {'Content-Type': 'application/json'} });
          const data = await res.json();
          status.style.display = 'block';
          if (data.success) {
            status.style.background = '#4CAF50';
            status.textContent = data.message;
            setTimeout(() => location.reload(), 1500);
          } else {
            status.style.background = '#f44336';
            status.textContent = data.error;
            btn.disabled = false;
            btn.textContent = 'ğŸŒ± Ù…Ù„Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
          }
        } catch(e) {
          status.style.display = 'block';
          status.style.background = '#f44336';
          status.textContent = 'Ø®Ø·Ø£: ' + e.message;
          btn.disabled = false;
          btn.textContent = 'ğŸŒ± Ù…Ù„Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
        }
      }
      async function clearDB() {
        if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!')) return;
        if (!confirm('âš ï¸âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø£Ø®ÙŠØ±: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§!')) return;
        const btn = document.getElementById('clear-btn');
        const status = document.getElementById('seed-status');
        btn.disabled = true;
        btn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...';
        try {
          const res = await fetch('/admin/clear', { method: 'POST', headers: {'Content-Type': 'application/json'} });
          const data = await res.json();
          status.style.display = 'block';
          if (data.success) {
            status.style.background = '#FF9800';
            status.textContent = data.message;
            setTimeout(() => location.reload(), 1500);
          } else {
            status.style.background = '#f44336';
            status.textContent = data.error;
          }
        } catch(e) {
          status.style.display = 'block';
          status.style.background = '#f44336';
          status.textContent = 'Ø®Ø·Ø£: ' + e.message;
        }
        btn.disabled = false;
        btn.textContent = 'ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
      }
    </script>

    <div class="tables-grid">
      <% tables.forEach(function(table) { %>
        <div class="table-card">
          <a href="/admin/table/<%= table %>">
            <h3><%= table %></h3>
            <div class="count">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: <span><%= stats[table] %></span></div>
          </a>
        </div>
      <% }); %>
    </div>
  </div>
</body>
</html>
